# Worldpay Within - The .NET SDK

The .NET implementation for the Worldpay Within IoT payment SDK. This SDK, or Software Development Kit, enables smart devices to discover each other, negogiate a price for services, make a payment (through the Worldpay Online Payment gateway) for services, and then consume services via a 'trusted trigger'. For more information see our documentation website here: http://www.worldpaywithin.com.

![The Worldpay Within puzzle piece](http://wptechinnovation.github.io/worldpay-within-sdk/images/architecture/worldpayWithinFig1.png)

## Getting Started

The .NET Worldpay Within wrapper provides a convenient entry point for application developers who wish to create applications using the Worldpay Within SDK.

Currently, there is no [nuget](https://nuget.org]) published libraries for this.  This issue is being tracked in [Issue #1 on GitHub](https://github.com/WPTechInnovation/wpw-sdk-dotnet/issues/1).

For now, you will need to build the project yourself, by following these steps:

1. Download the repository, e.g. `git clone git@github.com:WPTechInnovation/wpw-sdk-dotnet.git`.  See [project homepage](https://github.com/WPTechInnovation/wpw-sdk-dotnet) for more options.
1. Open up the solution file in Visual Studio 2017 (community edition or greater).
1. Build the solution.  Note that you must be connected to the Internet for nuget dependencies to be downloaded:
    * ApacheThrift 0.10.0
    * Common.Logging 3.3.1
    * Common.Logging.Core 3.3.1

To try it out:
1. Run the Unit Tests in `Worldpay.Within.Tests`.
1. Run the Sample application in `Worldpay.Within.Sample`.


## Introduction to the different projects

## Worldpay.Within

This is the main .NET wrapper entry point assembly.  The public API is contained within here, inside the `Worldpay.Within` package.

You can use Sandcastle to build the docs, however they will be published online at some point (see [Issue 2](https://github.com/WPTechInnovation/wpw-sdk-dotnet/issues/2)).

### Worldpay.Within.Rpc

This project contains nothing but the generated RPC wrappers for Thrift, you never edit code in here.  This is a separate project because the style and organisation of the code generated by the Thrift compiler is pretty poor; this approach isolates this to a single project.

You can rebuild this code first deleting all the existing source files and their directories, to clear out any existing code that may have been moved or removed in a new version, then running the Thrift compiler:

```thrift-0.10.0.exe -r -out %GOPATH%\src\innovation.worldpay.com\worldpay-within-sdk\wrappers\dotnet\Worldpay.Within\Worldpay.Within.Rpc --gen csharp:nullable,union %GOPATH%\src\innovation.worldpay.com\worldpay-within-sdk\rpc\wpwithin.thrift```

> The `-r` is there just for safety, in case subdirectories are used in future for storing dependent Thrift IDL files.

Note that the above oaths assume that you have downloaded the [Worldpay Within main SDK project](https://github.com/WPTechInnovation/worldpay-within-sdk) in to a regular "Go" development struture.  However, only the thrift interface files are actually required.  You can grab those directly from here: https://github.com/WPTechInnovation/worldpay-within-sdk/tree/master/rpc.  There are two files needed: `wptypes.thrift` and `wpwithin.thrift`, both files must be in the same directory.  They are not included within the .NET repository because they are centrally maintained and used to generate multiple language wrappers.

Be sure to refresh the project source tree in Visual Studio to ensure that any newly generated files are included in the project.  If you fail to do this, expect compile errors for missing types to be thrown.

## Using

To use Worldpay Within, add the following DLLs to your project path:

1. `Worldpay.Within.dll` - this contains the SDK code and public entry points.
1. `Worldpay.Within.Rpc.dll` - the Thrift compiler-generated code to bridge to the core Go SDK.
1. `Thrift.dll` - Apache Thrift library. 
1. `Logging Framework` - whatever logging framework we're going to use.

To run a Worldpay Within application, the Thrift RPC code will need to be able to talk to an RPC Agent.  The RPC Agent is a standalone application that manages the communication with remote third parties (for example, if you are creating a Consumer then the SDK code communicates with a local RPC Agent using the Thrift protocol, which then talks via HTTP to a remote RPC Agent, which then talks to a local Producer via the Thrift protocol).





  